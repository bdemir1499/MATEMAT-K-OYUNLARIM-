<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aritmetik Ortalama Macerasƒ±: Sƒ∞BERPUNK VERSƒ∞YON</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- ZARƒ∞F Sƒ∞BERPUNK TEMELƒ∞ --- */
        
        /* CSS Deƒüi≈ükenleri (Daha Pastel ve ƒ∞nce Mavi Paleti) */
        :root {
            --dark-bg: #0d1226;          /* Koyu lacivert/siyah */
            --main-neon: #89cff0;       /* Ana Neon: Pastel A√ßƒ±k Mavi */
            --secondary-neon: #aaffdd;  /* ƒ∞kincil Neon: A√ßƒ±k Mint Ye≈üili */
            --accent-neon: #ffe899;      /* Vurgu Neonu: Yumu≈üak Sarƒ± */
            --danger-neon: #ff9999;      /* Hata Neonu: Soluk Kƒ±rmƒ±zƒ± */
            --success-neon: #89cff0;     /* Ba≈üarƒ± Neonu: Pastel A√ßƒ±k Mavi */
            --font-color: #c7d1e1;      /* Ana yazƒ± rengi: Hafif gri-mavi */
            --border-color: #4a5c7f;    /* Genel √ßer√ßeve rengi: Koyu gri-mavi */
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background-color: var(--dark-bg);
            color: var(--font-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow: auto; 
        }

        /* --- YANIP S√ñNEN MATEMATƒ∞KSEL SEMBOLLER (HAFƒ∞FLETƒ∞LMƒ∞≈û) --- */
        @keyframes breathingGlow {
            0%, 100% {
                opacity: 0.05; /* Daha az g√∂r√ºn√ºr */
                text-shadow: none; /* G√∂lge yok veya √ßok az */
            }
            50% {
                opacity: 0.2; /* Hafif parlar */
                text-shadow: 0 0 5px currentColor; /* Daha az belirgin g√∂lge */
            }
        }

        body::before, body::after {
            position: fixed;
            z-index: -1;
            font-weight: bold;
            animation: breathingGlow 4s infinite ease-in-out;
            font-size: 1.8em; /* Biraz k√º√ß√ºlt√ºld√º */
        }

        /* Sol √ºst semboller */
        body::before {
            content: '\u03A3 \u222B \u03C0 \u221E';
            top: 8%;
            left: 5%;
            color: var(--main-neon);
            animation-duration: 5s;
        }

        /* Saƒü alt semboller */
        body::after {
            content: '\u03B1 \u03B2 \u2248 \u00B1 \u2202';
            bottom: 8%;
            right: 8%;
            color: var(--secondary-neon);
            animation-duration: 3.5s;
        }

        /* --- OYUN ARAY√úZ√ú --- */
        .game-container {
            width: 100%;
            max-width: 600px;
            background-color: rgba(16, 24, 48, 0.7); /* Biraz daha ≈üeffaf */
            border: 1px solid var(--border-color); /* Daha ince kenarlƒ±k */
            border-radius: 6px; /* Hafif yuvarlak k√∂≈üeler */
            box-shadow: 0 0 10px rgba(74, 92, 127, 0.5); /* Daha zarif g√∂lge */
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(2px); /* Daha az bulanƒ±klƒ±k */
        }

        h2 {
            color: var(--accent-neon);
            text-shadow: 0 0 5px rgba(255, 232, 153, 0.7); /* Yumu≈üak g√∂lge */
            border-bottom: 1px solid var(--border-color); /* ƒ∞nce ayƒ±rƒ±cƒ± √ßizgi */
            padding-bottom: 10px;
            text-transform: uppercase; 
            font-size: 1.6em; /* Biraz k√º√ß√ºlt√ºld√º */
        }

        /* --- Hƒ∞KAYE ALANI --- */
        .story-box {
            background-color: rgba(0, 0, 0, 0.2); /* Daha a√ßƒ±k arka plan */
            border: 1px dashed rgba(170, 255, 221, 0.5); /* Daha soluk noktalƒ± √ßizgi */
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
            min-height: 100px; 
            color: var(--font-color); /* Yazƒ± rengi */
        }
        #story-text {
            font-size: 1em; /* Biraz k√º√ß√ºlt√ºld√º */
            line-height: 1.6;
        }
        #data-set {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--accent-neon); 
            margin-top: 10px;
            text-align: center;
            text-shadow: 0 0 5px rgba(255, 232, 153, 0.7); /* Yumu≈üak g√∂lge */
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.1); /* Daha az belirgin arka plan */
            border-radius: 2px;
        }

        /* --- FORM√úL TAHTASI --- */
        .formula-section {
            margin-bottom: 25px;
            border: 1px dashed rgba(255, 255, 255, 0.08); /* Daha soluk ve ince √ßizgi */
            padding: 15px 5px;
        }
        
        .formula-title {
            color: var(--secondary-neon);
            font-size: 1em; /* Biraz k√º√ß√ºlt√ºld√º */
            margin-bottom: 10px;
            text-transform: uppercase;
            text-shadow: 0 0 3px rgba(170, 255, 221, 0.7); /* Yumu≈üak g√∂lge */
        }

        .formula-board {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            font-size: 2.2em; /* Biraz k√º√ß√ºlt√ºld√º */
            font-weight: bold;
            color: var(--accent-neon);
            text-shadow: 0 0 3px rgba(255, 232, 153, 0.7); /* Yumu≈üak g√∂lge */
        }
        
        .formula-row {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            font-size: 1.2em; /* Biraz k√º√ß√ºlt√ºld√º */
            font-weight: bold;
            color: var(--secondary-neon);
            text-shadow: 0 0 2px rgba(170, 255, 221, 0.7); /* Yumu≈üak g√∂lge */
        }
        .formula-row span {
            margin: 0 8px; /* Bo≈üluk azaltƒ±ldƒ± */
        }

        .formula-label {
            margin-right: 12px;
        }

        .fraction-line {
            width: 120px; /* √áizgi inceltildi */
            height: 2px; /* √áizgi inceltildi */
            background-color: var(--accent-neon);
            box-shadow: 0 0 3px rgba(255, 232, 153, 0.7); /* Yumu≈üak g√∂lge */
            margin: 4px 0;
        }

        /* V.T ve V.S Giri≈ü Kutularƒ± */
        .formula-input {
            width: 130px; /* Geni≈ülik azaltƒ±ldƒ± */
            height: 38px; /* Y√ºkseklik azaltƒ±ldƒ± */
            font-family: 'Roboto Mono', monospace;
            font-size: 0.95em; /* Yazƒ± boyutu azaltƒ±ldƒ± */
            text-align: center;
            background-color: #070b1a; /* Daha koyu arka plan */
            color: var(--font-color);
            border: 1px solid var(--border-color); /* Daha ince kenarlƒ±k */
            border-radius: 3px;
            transition: all 0.3s;
        }
        .formula-input:focus {
            border-color: var(--accent-neon);
            box-shadow: 0 0 8px rgba(255, 232, 153, 0.7); /* Daha zarif g√∂lge */
            outline: none;
        }
        .formula-input[type="text"] {
            cursor: pointer;
            background-color: #0c1220; /* Odaklanƒ±nca daha belirgin arka plan */
        }
        .formula-input::placeholder {
            font-size: 0.7em;
            color: #777;
        }

        /* --- MOBƒ∞L UYUMLULUK --- */
        @media (max-width: 500px) {
            .formula-row {
                flex-wrap: wrap; 
                justify-content: space-around; 
            }
            .formula-row > * {
                flex-grow: 1; 
                margin: 4px; 
                min-width: 70px; 
            }
            .formula-input {
                width: 100%; 
                max-width: 100px; /* Biraz daha daraltƒ±ldƒ± */
                box-sizing: border-box;
                height: 32px; 
            }
            
            .formula-row span {
                margin: 4px; 
                font-size: 0.9em; 
                align-self: center; 
            }
            
             .calculator-popup {
                width: 95%; /* Mobil cihazda daha geni≈ü yer kaplasƒ±n */
                padding: 10px;
            }
            .calc-keys button {
                padding: 15px; /* Tu≈ülar biraz k√º√ß√ºlt√ºld√º */
                font-size: 1em;
            }
            #calc-display {
                font-size: 1.2em; /* Hesap makinesi ekranƒ± k√º√ß√ºlt√ºld√º */
            }
        }
        /* --- BUTONLAR --- */
        #calculate-btn, #new-game-btn {
            width: 100%;
            padding: 12px; /* D√ºƒüme dolgusu azaltƒ±ldƒ± */
            font-size: 1.1em; /* Yazƒ± boyutu azaltƒ±ldƒ± */
            font-weight: bold;
            font-family: 'Roboto Mono', monospace;
            text-transform: uppercase;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px; /* Bo≈üluk ayarƒ± */
        }

        #calculate-btn {
            display: none;
            background-color: var(--success-neon);
            color: var(--dark-bg);
            border: none;
            box-shadow: 0 0 8px rgba(137, 207, 240, 0.7); /* Daha zarif g√∂lge */
            margin-top: 10px;
        }
        #calculate-btn:hover {
            background-color: var(--dark-bg);
            color: var(--success-neon);
            border: 1px solid var(--success-neon); /* ƒ∞nce kenarlƒ±k */
        }

        #new-game-btn {
            background-color: transparent;
            color: var(--main-neon);
            border: 1px solid var(--main-neon); /* ƒ∞nce kenarlƒ±k */
            margin-top: 15px; /* Bo≈üluk ayarƒ± */
        }
        #new-game-btn:hover {
            background-color: var(--main-neon);
            color: var(--dark-bg);
            box-shadow: 0 0 8px rgba(137, 207, 240, 0.7); /* Daha zarif g√∂lge */
        }

        /* --- HESAP MAKƒ∞NESƒ∞ (Panel) --- */
        .calculator-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--dark-bg);
            border: 1px solid var(--secondary-neon); /* ƒ∞nce kenarlƒ±k */
            box-shadow: 0 0 15px rgba(170, 255, 221, 0.7); /* Daha zarif g√∂lge */
            border-radius: 6px;
            z-index: 1000;
            width: 320px; /* Geni≈ülik azaltƒ±ldƒ± */
            padding-bottom: 10px;
        }
        
        #calc-data-set {
            background-color: rgba(255, 255, 255, 0.03); /* Daha ≈üeffaf */
            padding: 8px;
            margin: 10px 12px;
            border: 1px dashed rgba(255, 153, 153, 0.5); /* Daha soluk noktalƒ± √ßizgi */
            font-size: 0.9em;
            color: var(--danger-neon);
            text-shadow: 0 0 2px rgba(255, 153, 153, 0.7);
            max-height: 80px; /* Y√ºkseklik azaltƒ±ldƒ± */
            overflow-y: auto; 
        }
        
        .calc-header {
            background-color: #1a1f33; /* Daha uyumlu arka plan */
            padding: 8px;
            font-weight: bold;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            color: var(--secondary-neon);
            font-size: 1em;
        }
        #calc-display {
            width: calc(100% - 24px); /* Kenar bo≈üluƒüu d√ºzenlendi */
            margin: 12px;
            padding: 12px 10px;
            font-size: 1.3em;
            font-family: 'Roboto Mono', monospace;
            text-align: right;
            background-color: #000;
            color: var(--font-color);
            border: 1px solid var(--secondary-neon);
            border-radius: 4px;
        }
        .calc-keys {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px; /* Bo≈üluklar azaltƒ±ldƒ± */
            padding: 0 12px 0;
        }
        .calc-keys button {
            padding: 18px; /* Tu≈ü dolgusu azaltƒ±ldƒ± */
            font-size: 1.1em;
            font-family: 'Roboto Mono', monospace;
            border: 1px solid var(--border-color); /* ƒ∞nce kenarlƒ±k */
            border-radius: 3px;
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.2); /* Daha ≈üeffaf */
            color: var(--font-color); /* Tu≈ü yazƒ±larƒ± */
            transition: all 0.2s;
        }
        .calc-keys button:hover {
            background-color: rgba(170, 255, 221, 0.2); /* Hafif parlamalƒ± hover */
            color: var(--secondary-neon);
            box-shadow: 0 0 8px rgba(170, 255, 221, 0.7); /* Yumu≈üak g√∂lge */
        }
        .calc-keys .key-op {
            color: var(--accent-neon);
            border-color: rgba(255, 232, 153, 0.7); /* Yumu≈üak sarƒ± kenarlƒ±k */
        }
        .calc-keys .key-op:hover {
            background-color: rgba(255, 232, 153, 0.2);
            color: var(--accent-neon);
        }
        .key-confirm {
            grid-column: span 4;
            background-color: var(--main-neon);
            color: var(--dark-bg);
            border: none;
            box-shadow: 0 0 8px rgba(137, 207, 240, 0.7);
        }
        .key-confirm:hover {
            background-color: var(--accent-neon);
            color: var(--dark-bg);
            box-shadow: 0 0 10px rgba(255, 232, 153, 0.9);
        }

        /* --- GERƒ∞ Bƒ∞LDƒ∞Rƒ∞M VE YENƒ∞ G√ñREV --- */
        #feedback-area {
            margin-top: 20px;
            font-size: 1em;
            font-weight: bold;
            padding: 12px;
            border-radius: 4px;
            text-shadow: 0 0 3px currentColor; /* Yumu≈üak g√∂lge */
        }
        .feedback-correct {
            background-color: rgba(137, 207, 240, 0.1); /* Daha ≈üeffaf */
            color: var(--success-neon);
            border: 1px solid var(--success-neon);
        }
        .feedback-wrong {
            background-color: rgba(255, 153, 153, 0.1); /* Daha ≈üeffaf */
            color: var(--danger-neon);
            border: 1px solid var(--danger-neon);
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h2>Aritmetik Ortalama Macerasƒ±</h2>

        <div class="story-box">
            <p id="story-text">Y√ºkleniyor...</p>
            <div id="data-set"></div> 
        </div>

        <div class="formula-section" id="formula-section-1">
            <div class="formula-title">Temel A.O. Hesaplama</div>
            <div class="formula-board">
                <span class="formula-label">A.O =</span>
                <div class="fraction">
                    <input type="text" id="input-vt" class="formula-input" placeholder="V.T'yi Hesapla" readonly>
                    <div class="fraction-line"></div>
                    <input type="number" id="input-vs" class="formula-input" placeholder="V.S'yi Gir">
                </div>
            </div>
        </div>

        <div class="formula-section" id="formula-section-2">
             <div class="formula-title">Ters Hesaplama (Kayƒ±p Veri)</div>
            
            <div class="formula-row">
                <input type="text" id="input-vt-calc" class="formula-input" placeholder="V.T Giri≈üi" readonly>
                <span>=</span>
                <input type="text" id="input-ao-vt" class="formula-input" placeholder="A.O Giri≈üi" readonly>
                <span>x</span>
                <input type="number" id="input-vs-vt" class="formula-input" placeholder="V.S Giri≈üi">
            </div>
            
            <div class="formula-row">
                <input type="number" id="input-vs-calc" class="formula-input" placeholder="V.S Giri≈üi">
                <span>=</span>
                <input type="text" id="input-vt-vs" class="formula-input" placeholder="V.T Giri≈üi" readonly>
                <span>/</span>
                <input type="number" id="input-ao-vs" class="formula-input" placeholder="A.O Giri≈üi">
            </div>
        </div>


        <button id="calculate-btn">Hesapla</button>

        <div id="feedback-area"></div>

        <button id="new-game-btn">Yeni G√∂rev</button>
    </div>

    <div class="calculator-popup" id="calculator">
        <div class="calc-header">Hesaplayƒ±cƒ± (V.T. ve Diƒüer ƒ∞≈ülemler)</div>
        
        <div id="calc-data-set"></div>

        <input type="text" id="calc-display" readonly>
        <div class="calc-keys">
            <button class="key-op" onclick="appendToDisplay('+')">+</button>
            <button class="key-op" onclick="appendToDisplay('-')">-</button>
            <button class="key-op" onclick="appendToDisplay('*')">x</button>
            <button class="key-op" onclick="appendToDisplay('/')">√∑</button>

            <button onclick="appendToDisplay('7')">7</button>
            <button onclick="appendToDisplay('8')">8</button>
            <button onclick="appendToDisplay('9')">9</button>
            <button onclick="appendToDisplay('(')">(</button>
            
            <button onclick="appendToDisplay('4')">4</button>
            <button onclick="appendToDisplay('5')">5</button>
            <button onclick="appendToDisplay('6')">6</button>
            <button onclick="appendToDisplay(')')">)</button>
            
            <button onclick="appendToDisplay('1')">1</button>
            <button onclick="appendToDisplay('2')">2</button>
            <button onclick="appendToDisplay('3')">3</button>
            <button onclick="appendToDisplay('.')">.</button>
            
            <button class="key-op" onclick="clearDisplay()">Sil</button>
            <button onclick="appendToDisplay('0')">0</button>
            <button class="key-op" onclick="calculateResult()">=</button>
            <button class="key-op" onclick="clearAll()">C</button>
            
            <button class="key-confirm" onclick="confirmVT()">Sonucu Giri≈üe Yansƒ±t</button>
        </div>
    </div>

    <script>
        // --- OYUN VERƒ∞LERƒ∞ ---
        const gameData = [
             // Tip 1: Klasik A.O. Hesaplama (3 Senaryo)
            {
                type: 1,
                story: "Sincap √áƒ±t√ßƒ±t, 5 g√ºn boyunca kƒ±≈ü i√ßin ceviz topladƒ±. G√ºnl√ºk topladƒ±ƒüƒ± ceviz sayƒ±larƒ±:",
                data: [12, 10, 15, 8, 20],
                answerType: 'AO'
            },
            {
                type: 1,
                story: "Basketbolcu Efe, son 4 ma√ßta ≈üu sayƒ±larƒ± attƒ±:",
                data: [22, 18, 25, 19],
                answerType: 'AO'
            },
            {
                type: 1,
                story: "Bir haftalƒ±k (7 g√ºn) hava sƒ±caklƒ±klarƒ± (¬∞C) ≈ü√∂yle √∂l√ß√ºld√º:",
                data: [24, 26, 23, 25, 22, 27, 26],
                answerType: 'AO'
            },
            // Tip 2: Kayƒ±p Veri Bulma (V.T. = A.O x V.S. ile Kayƒ±p Deƒüer Bulma) - 2 Senaryo
            {
                type: 2,
                // Kayƒ±p ki≈üi ya≈ü: (5 * 24) - (4 * 20) = 120 - 80 = 40
                story: "4 ki≈üilik turist kafilesinin ya≈ü ortalamasƒ± **20**'dir. Gruba sonradan bir ki≈üi daha katƒ±ldƒ± ve grubun yeni ya≈ü ortalamasƒ± **24** oldu. Son katƒ±lan ki≈üi ka√ß ya≈üƒ±ndadƒ±r?",
                formulaNeeded: 'VT',
                data: {
                    vt1: 4 * 20, 
                    vs1: 4,      
                    ao2: 24,     
                    vs2: 5       
                },
                question: 'Son katƒ±lan ki≈üinin ya≈üƒ±nƒ±',
                correctAO: 40 
            },
            {
                type: 2,
                // Yanlƒ±≈ü okunan not: (5 * 80) - (4 * 70) = 400 - 280 = 120
                story: "5 ki≈üilik arkada≈ü grubunun matematikten son yazƒ±lƒ±dan aldƒ±klarƒ± notlarƒ±n ortalamasƒ± **80**'dir. Bu gruptan birinin yazƒ±lƒ± kaƒüƒ±dƒ±nƒ±n yanlƒ±≈ü okunduƒüu anla≈üƒ±ldƒ± ve **kalan 4** √∂ƒürencinin ortalamasƒ±nƒ±n **70** olduƒüu g√∂r√ºld√º. Buna g√∂re, kaƒüƒ±dƒ± yanlƒ±≈ü okunan √∂ƒürencinin notu ka√ß olmalƒ±dƒ±r?",
                formulaNeeded: 'VT',
                data: {
                    vt1: 5 * 80, 
                    vs1: 5,
                    ao2: 70, 
                    vs2: 4   
                },
                question: 'Kaƒüƒ±dƒ± yanlƒ±≈ü okunan √∂ƒürencinin notunu',
                correctAO: 120
            },
             // Tip 2: Kayƒ±p Veri Bulma (V.S. = V.T. / A.O. ile Veri Sayƒ±sƒ± Bulma) - 4 Senaryo
            {
                type: 2,
                // ƒ∞≈ü√ßi sayƒ±sƒ±: 5000 / 100 = 50
                story: "Bir fabrikadaki i≈ü√ßilerin g√ºnl√ºk ortalama √ºretimi **100** birimdir. Fabrikadaki toplam √ºretim **5000** birim olduƒüuna g√∂re, fabrikada ka√ß i≈ü√ßi (V.S.) √ßalƒ±≈ümaktadƒ±r?",
                formulaNeeded: 'VS',
                data: {
                    vt: 5000,
                    ao: 100
                },
                question: '√áalƒ±≈üan i≈ü√ßi sayƒ±sƒ±nƒ± (V.S.)',
                correctAO: 50 
            },
            {
                type: 2,
                // Okunan G√ºn Sayƒ±sƒ±: 350 / 70 = 5
                story: "Bir √∂ƒürencinin birka√ß g√ºnde okuduƒüu toplam sayfa sayƒ±sƒ± **350**'dir. Bu √∂ƒürencinin g√ºnl√ºk okuduƒüu ortalama sayfa sayƒ±sƒ± **70** sayfa ise, √∂ƒürenci ka√ß g√ºn (V.S.) kitap okumu≈ütur?",
                formulaNeeded: 'VS',
                data: {
                    vt: 350,
                    ao: 70
                },
                question: 'Kitap okuduƒüu g√ºn sayƒ±sƒ±nƒ± (V.S.)',
                correctAO: 5 
            },
            {
                type: 2,
                // Ma√ß Sayƒ±sƒ±: 100 / 25 = 4
                story: "Bir futbolcunun attƒ±ƒüƒ± toplam gol sayƒ±sƒ± **100**'d√ºr. Ma√ß ba≈üƒ±na d√º≈üen ortalama gol sayƒ±sƒ± **25** olduƒüuna g√∂re, futbolcu ka√ß ma√ß (V.S.) oynamƒ±≈ütƒ±r?",
                formulaNeeded: 'VS',
                data: {
                    vt: 100,
                    ao: 25
                },
                question: 'Oynadƒ±ƒüƒ± ma√ß sayƒ±sƒ±nƒ± (V.S.)',
                correctAO: 4 
            },
            {
                type: 2,
                // G√ºnl√ºk Satƒ±≈ü Adedi: 1200 / 60 = 20
                story: "Bir maƒüazanƒ±n bir ayda sattƒ±ƒüƒ± toplam ti≈ü√∂rt sayƒ±sƒ± **1200** adettir. Maƒüazanƒ±n g√ºnl√ºk ortalama ti≈ü√∂rt satƒ±≈üƒ± **60** adet olduƒüuna g√∂re, ka√ß g√ºn (V.S.) satƒ±≈ü yapmƒ±≈ütƒ±r? (1 ay 30 g√ºn kabul edin.)",
                formulaNeeded: 'VS',
                data: {
                    vt: 1200,
                    ao: 60
                },
                question: 'Satƒ±≈ü yaptƒ±ƒüƒ± g√ºn sayƒ±sƒ±nƒ± (V.S.)',
                correctAO: 20 
            }
        ];

        let currentProblem = {};
        let activeInputId = null; // Hangi inputun hesap makinesini a√ßtƒ±ƒüƒ±nƒ± takip eder

        // --- HTML ELEMENTLERƒ∞Nƒ∞ SE√áME ---
        const storyText = document.getElementById('story-text');
        const dataSetText = document.getElementById('data-set');
        
        // Tip 1 alanlarƒ±
        const inputVT = document.getElementById('input-vt');
        const inputVS = document.getElementById('input-vs');
        
        // Tip 2 alanlarƒ± (V.T. = A.O x V.S)
        const inputVTCalc = document.getElementById('input-vt-calc'); // SONU√á Gƒ∞Rƒ∞≈ûƒ∞ (Kayƒ±p Deƒüer)
        const inputAOVt = document.getElementById('input-ao-vt');
        const inputVSVt = document.getElementById('input-vs-vt');
        
        // Tip 2 alanlarƒ± (V.S. = V.T / A.O)
        const inputVSCalc = document.getElementById('input-vs-calc'); // SONU√á Gƒ∞Rƒ∞≈ûƒ∞ (Veri Sayƒ±sƒ±)
        const inputVTVs = document.getElementById('input-vt-vs');
        const inputAOVB = document.getElementById('input-ao-vs'); 

        const formulaSection1 = document.getElementById('formula-section-1');
        const formulaSection2 = document.getElementById('formula-section-2');

        const calculateBtn = document.getElementById('calculate-btn');
        const feedbackArea = document.getElementById('feedback-area');
        const newGameBtn = document.getElementById('new-game-btn');
        const calculator = document.getElementById('calculator');
        const calcDisplay = document.getElementById('calc-display');
        const calcDataSet = document.getElementById('calc-data-set');

        // --- HESAPLAMA POP-UP MANTIƒûI ---
        function showCalculator(inputId, showData = false) {
            activeInputId = inputId;
            calcDisplay.value = '';
            
            if (showData && currentProblem.data && Array.isArray(currentProblem.data)) {
                calcDataSet.innerText = `Veri Seti: [ ${currentProblem.data.join(', ')} ]`;
                calcDataSet.style.display = 'block';
            } else {
                calcDataSet.style.display = 'none';
            }
            
            calculator.style.display = 'block';
        }
        
        // Hesap Makinesini a√ßan inputlar:
        inputVT.addEventListener('click', () => showCalculator('input-vt', true));
        inputVTCalc.addEventListener('click', () => showCalculator('input-vt-calc', false));
        inputAOVt.addEventListener('click', () => showCalculator('input-ao-vt', false));
        inputVTVs.addEventListener('click', () => showCalculator('input-vt-vs', false));
        
        
        function appendToDisplay(value) {
            const lastChar = calcDisplay.value.slice(-1);
            if (['+', '-', '*', '/'].includes(value) && ['+', '-', '*', '/'].includes(lastChar)) {
                calcDisplay.value = calcDisplay.value.slice(0, -1) + value; 
            } else {
                calcDisplay.value += value;
            }
        }

        function clearDisplay() {
            calcDisplay.value = calcDisplay.value.slice(0, -1);
        }
        
        function clearAll() {
            calcDisplay.value = '';
        }
        
        function calculateResult() {
            try {
                // G√ºvenli hesaplama
                const result = new Function('return ' + calcDisplay.value.replace(/x/g, '*').replace(/√∑/g, '/'))(); 
                calcDisplay.value = result;
            } catch (error) {
                calcDisplay.value = 'HATA';
            }
        }

        function confirmVT() {
            calculateResult(); 

            const targetInput = document.getElementById(activeInputId);
            
            if (targetInput && calcDisplay.value !== 'HATA') {
                targetInput.value = calcDisplay.value;
            }
            calculator.style.display = 'none';
            checkInputs(); // Giri≈ü yapƒ±ldƒ±ktan sonra butonu kontrol et
        }

        // --- OYUN MANTIƒûI ---
        function startNewGame() {
            const randomIndex = Math.floor(Math.random() * gameData.length);
            const problem = gameData[randomIndex];
            currentProblem = problem;

            storyText.innerText = problem.story;
            feedbackArea.innerHTML = '';
            feedbackArea.className = '';
            calculateBtn.style.display = 'none'; // Ba≈ülangƒ±√ßta butonu gizle

            document.querySelectorAll('.formula-input').forEach(input => input.value = '');
            
            if (problem.type === 1) {
                // Tip 1: Klasik A.O.
                formulaSection1.style.display = 'block';
                formulaSection2.style.display = 'none';
                
                dataSetText.innerText = `[ ${problem.data.join(', ')} ]`;
                dataSetText.style.display = 'block'; 
                
            } else {
                // Tip 2: Kayƒ±p Veri Bulma
                formulaSection1.style.display = 'none';
                formulaSection2.style.display = 'block';
                
                dataSetText.innerText = ''; 
                dataSetText.style.display = 'none';
                
                // Placeholder ayarlarƒ±
                inputVTCalc.placeholder = problem.formulaNeeded === 'VT' ? 'SONU√á' : 'V.T Giri≈üi';
                inputVSCalc.placeholder = problem.formulaNeeded === 'VS' ? 'SONU√á' : 'V.S Giri≈üi';
                
                // Tip 2'de ilgili sabit deƒüerleri doldur
                if (problem.formulaNeeded === 'VT') {
                    // Kayƒ±p Deƒüer (V.T.) i√ßin gerekli olan A.O ve V.S deƒüerleri
                    inputAOVt.value = problem.data.ao2;
                    inputVSVt.value = problem.data.vs2;
                } else if (problem.formulaNeeded === 'VS') {
                    // Veri Sayƒ±sƒ± (V.S.) i√ßin gerekli olan V.T ve A.O deƒüerleri
                    inputVTVs.value = problem.data.vt;
                    inputAOVB.value = problem.data.ao;
                }
            }
        }

        // --- HESAPLA BUTONU KONTROL√ú (D√úZELTƒ∞LMƒ∞≈û) ---
        function checkInputs() {
            let buttonShouldBeVisible = false;
            
            if (currentProblem.type === 1) {
                // Tip 1: Hem VT hem de VS dolu olmalƒ±
                if (inputVT.value.trim() && inputVS.value.trim() && parseFloat(inputVS.value.trim()) > 0) {
                    buttonShouldBeVisible = true;
                }
            } 
            
            else if (currentProblem.type === 2) {
                if (currentProblem.formulaNeeded === 'VT') {
                    // Tip 2 (Kayƒ±p Deƒüer): Sadece FINAL SONU√á kutusu (inputVTCalc) dolu olmalƒ±
                    if (inputVTCalc.value.trim()) { 
                        buttonShouldBeVisible = true;
                    }
                } else if (currentProblem.formulaNeeded === 'VS') {
                    // Tip 2 (Veri Sayƒ±sƒ±): Sadece FINAL SONU√á kutusu (inputVSCalc) dolu olmalƒ±
                    if (inputVSCalc.value.trim()) { 
                        buttonShouldBeVisible = true;
                    }
                }
            }

            if (buttonShouldBeVisible) {
                calculateBtn.style.display = 'block';
            } else {
                calculateBtn.style.display = 'none';
            }
        }

        function checkAnswer() {
            let userAnswer = NaN;
            
            // Tip 1: Klasik A.O. Kontrol√º
            if (currentProblem.type === 1) {
                const userVT = parseFloat(inputVT.value);
                const userVS = parseFloat(inputVS.value);
                
                const correctVT = currentProblem.data.reduce((sum, current) => sum + current, 0);
                const correctVS = currentProblem.data.length;
                const correctAO = correctVT / correctVS;
                
                if (Math.abs(userVT - correctVT) < 0.01 && Math.abs(userVS - correctVS) < 0.01) {
                    feedbackArea.className = 'feedback-correct';
                    feedbackArea.innerHTML = `üéâ TEBRƒ∞KLER! Ortalama ba≈üarƒ±yla hesaplandƒ±: **A.O = ${correctAO.toFixed(2)}**`;
                } else if (Math.abs(userVT - correctVT) >= 0.01) {
                    feedbackArea.className = 'feedback-wrong';
                    feedbackArea.innerHTML = `‚ö†Ô∏è HATA: **Verilerin Toplamƒ± (V.T)** yanlƒ±≈ü girildi. Tekrar kontrol et.`;
                } else if (Math.abs(userVS - correctVS) >= 0.01) {
                    feedbackArea.className = 'feedback-wrong';
                    feedbackArea.innerHTML = `‚ö†Ô∏è HATA: **Veri Sayƒ±sƒ± (V.S)** yanlƒ±≈ü girildi. Tekrar kontrol et.`;
                }
            } 
            
            // Tip 2: Kayƒ±p Veri Kontrol√º
            else if (currentProblem.type === 2) {
                if (currentProblem.formulaNeeded === 'VT') {
                    userAnswer = parseFloat(inputVTCalc.value); 
                } else if (currentProblem.formulaNeeded === 'VS') {
                    userAnswer = parseFloat(inputVSCalc.value); 
                }
                
                const correctFinalAnswer = currentProblem.correctAO; 
                
                if (Math.abs(userAnswer - correctFinalAnswer) < 0.01) {
                     feedbackArea.className = 'feedback-correct';
                     feedbackArea.innerHTML = `üéâ TEBRƒ∞KLER! **${currentProblem.question}** doƒüru bulundu: **${correctFinalAnswer}**`;
                } else {
                     feedbackArea.className = 'feedback-wrong';
                     feedbackArea.innerHTML = `‚ö†Ô∏è HATA: **${currentProblem.question}** yanlƒ±≈ü hesaplandƒ±. Cevabƒ±n **${correctFinalAnswer}** olmasƒ± gerekiyordu. Form√ºlleri doƒüru kullandƒ±ƒüƒ±ndan emin ol.`;
                }
            }
        }

        // --- OLAY Dƒ∞NLEYƒ∞Cƒ∞LER (EVENT LISTENERS) ---
        
        // Tip 1 Kontrol√º i√ßin dinleyici
        inputVS.addEventListener('input', checkInputs);
        
        // Tip 2 Kontrol√º i√ßin final sonu√ß kutularƒ±na dinleyici eklendi
        // Kullanƒ±cƒ± bu kutulara manuel olarak da yazabilir.
        inputVSCalc.addEventListener('input', checkInputs);
        inputVTCalc.addEventListener('input', checkInputs);
        
        // Diƒüer inputlara da dinleyici eklendi, b√∂ylece herhangi bir etkile≈üimde kontrol tetiklenir.
        inputVSVt.addEventListener('input', checkInputs);
        inputAOVB.addEventListener('input', checkInputs);
        inputVTVs.addEventListener('input', checkInputs);
        inputAOVB.addEventListener('input', checkInputs);
        
        
        calculateBtn.addEventListener('click', checkAnswer);
        newGameBtn.addEventListener('click', startNewGame);

        // Sayfa ilk y√ºklendiƒüinde oyunu ba≈ülat
        startNewGame();
    </script>
</body>
</html>
