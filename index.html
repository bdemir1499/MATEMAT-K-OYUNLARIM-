<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aritmetik Ortalama Macerası: SİBERPUNK VERSİYON</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- ZARİF SİBERPUNK TEMELİ --- */
        
        /* CSS Değişkenleri (Daha Pastel ve İnce Mavi Paleti) */
        :root {
            --dark-bg: #0d1226;          /* Koyu lacivert/siyah */
            --main-neon: #89cff0;       /* Ana Neon: Pastel Açık Mavi */
            --secondary-neon: #aaffdd;  /* İkincil Neon: Açık Mint Yeşili */
            --accent-neon: #ffe899;      /* Vurgu Neonu: Yumuşak Sarı */
            --danger-neon: #ff9999;      /* Hata Neonu: Soluk Kırmızı */
            --success-neon: #89cff0;     /* Başarı Neonu: Pastel Açık Mavi */
            --font-color: #c7d1e1;      /* Ana yazı rengi: Hafif gri-mavi */
            --border-color: #4a5c7f;    /* Genel çerçeve rengi: Koyu gri-mavi */
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background-color: var(--dark-bg);
            color: var(--font-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow: auto; 
        }

        /* --- YANIP SÖNEN MATEMATİKSEL SEMBOLLER (HAFİFLETİLMİŞ) --- */
        @keyframes breathingGlow {
            0%, 100% {
                opacity: 0.05; /* Daha az görünür */
                text-shadow: none; /* Gölge yok veya çok az */
            }
            50% {
                opacity: 0.2; /* Hafif parlar */
                text-shadow: 0 0 5px currentColor; /* Daha az belirgin gölge */
            }
        }

        body::before, body::after {
            position: fixed;
            z-index: -1;
            font-weight: bold;
            animation: breathingGlow 4s infinite ease-in-out;
            font-size: 1.8em; /* Biraz küçültüldü */
        }

        /* Sol üst semboller */
        body::before {
            content: '\u03A3 \u222B \u03C0 \u221E';
            top: 8%;
            left: 5%;
            color: var(--main-neon);
            animation-duration: 5s;
        }

        /* Sağ alt semboller */
        body::after {
            content: '\u03B1 \u03B2 \u2248 \u00B1 \u2202';
            bottom: 8%;
            right: 8%;
            color: var(--secondary-neon);
            animation-duration: 3.5s;
        }

        /* --- OYUN ARAYÜZÜ --- */
        .game-container {
            width: 100%;
            max-width: 600px;
            background-color: rgba(16, 24, 48, 0.7); /* Biraz daha şeffaf */
            border: 1px solid var(--border-color); /* Daha ince kenarlık */
            border-radius: 6px; /* Hafif yuvarlak köşeler */
            box-shadow: 0 0 10px rgba(74, 92, 127, 0.5); /* Daha zarif gölge */
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(2px); /* Daha az bulanıklık */
        }

        h2 {
            color: var(--accent-neon);
            text-shadow: 0 0 5px rgba(255, 232, 153, 0.7); /* Yumuşak gölge */
            border-bottom: 1px solid var(--border-color); /* İnce ayırıcı çizgi */
            padding-bottom: 10px;
            text-transform: uppercase; 
            font-size: 1.6em; /* Biraz küçültüldü */
        }

        /* --- HİKAYE ALANI --- */
        .story-box {
            background-color: rgba(0, 0, 0, 0.2); /* Daha açık arka plan */
            border: 1px dashed rgba(170, 255, 221, 0.5); /* Daha soluk noktalı çizgi */
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
            min-height: 100px; 
            color: var(--font-color); /* Yazı rengi */
        }
        #story-text {
            font-size: 1em; /* Biraz küçültüldü */
            line-height: 1.6;
        }
        #data-set {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--accent-neon); 
            margin-top: 10px;
            text-align: center;
            text-shadow: 0 0 5px rgba(255, 232, 153, 0.7); /* Yumuşak gölge */
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.1); /* Daha az belirgin arka plan */
            border-radius: 2px;
        }

        /* --- FORMÜL TAHTASI --- */
        .formula-section {
            margin-bottom: 25px;
            border: 1px dashed rgba(255, 255, 255, 0.08); /* Daha soluk ve ince çizgi */
            padding: 15px 5px;
        }
        
        .formula-title {
            color: var(--secondary-neon);
            font-size: 1em; /* Biraz küçültüldü */
            margin-bottom: 10px;
            text-transform: uppercase;
            text-shadow: 0 0 3px rgba(170, 255, 221, 0.7); /* Yumuşak gölge */
        }

        .formula-board {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            font-size: 2.2em; /* Biraz küçültüldü */
            font-weight: bold;
            color: var(--accent-neon);
            text-shadow: 0 0 3px rgba(255, 232, 153, 0.7); /* Yumuşak gölge */
        }
        
        .formula-row {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            font-size: 1.2em; /* Biraz küçültüldü */
            font-weight: bold;
            color: var(--secondary-neon);
            text-shadow: 0 0 2px rgba(170, 255, 221, 0.7); /* Yumuşak gölge */
        }
        .formula-row span {
            margin: 0 8px; /* Boşluk azaltıldı */
        }

        .formula-label {
            margin-right: 12px;
        }

        .fraction-line {
            width: 120px; /* Çizgi inceltildi */
            height: 2px; /* Çizgi inceltildi */
            background-color: var(--accent-neon);
            box-shadow: 0 0 3px rgba(255, 232, 153, 0.7); /* Yumuşak gölge */
            margin: 4px 0;
        }

        /* V.T ve V.S Giriş Kutuları */
        .formula-input {
            width: 130px; /* Genişlik azaltıldı */
            height: 38px; /* Yükseklik azaltıldı */
            font-family: 'Roboto Mono', monospace;
            font-size: 0.95em; /* Yazı boyutu azaltıldı */
            text-align: center;
            background-color: #070b1a; /* Daha koyu arka plan */
            color: var(--font-color);
            border: 1px solid var(--border-color); /* Daha ince kenarlık */
            border-radius: 3px;
            transition: all 0.3s;
        }
        .formula-input:focus {
            border-color: var(--accent-neon);
            box-shadow: 0 0 8px rgba(255, 232, 153, 0.7); /* Daha zarif gölge */
            outline: none;
        }
        .formula-input[type="text"] {
            cursor: pointer;
            background-color: #0c1220; /* Odaklanınca daha belirgin arka plan */
        }
        .formula-input::placeholder {
            font-size: 0.7em;
            color: #777;
        }

        /* --- MOBİL UYUMLULUK --- */
        @media (max-width: 500px) {
            .formula-row {
                flex-wrap: wrap; 
                justify-content: space-around; 
            }
            .formula-row > * {
                flex-grow: 1; 
                margin: 4px; 
                min-width: 70px; 
            }
            .formula-input {
                width: 100%; 
                max-width: 100px; /* Biraz daha daraltıldı */
                box-sizing: border-box;
                height: 32px; 
            }
            
            .formula-row span {
                margin: 4px; 
                font-size: 0.9em; 
                align-self: center; 
            }
            
             .calculator-popup {
                width: 95%; /* Mobil cihazda daha geniş yer kaplasın */
                padding: 10px;
            }
            .calc-keys button {
                padding: 15px; /* Tuşlar biraz küçültüldü */
                font-size: 1em;
            }
            #calc-display {
                font-size: 1.2em; /* Hesap makinesi ekranı küçültüldü */
            }
        }
        /* --- BUTONLAR --- */
        #calculate-btn, #new-game-btn {
            width: 100%;
            padding: 12px; /* Düğme dolgusu azaltıldı */
            font-size: 1.1em; /* Yazı boyutu azaltıldı */
            font-weight: bold;
            font-family: 'Roboto Mono', monospace;
            text-transform: uppercase;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px; /* Boşluk ayarı */
        }

        #calculate-btn {
            display: none;
            background-color: var(--success-neon);
            color: var(--dark-bg);
            border: none;
            box-shadow: 0 0 8px rgba(137, 207, 240, 0.7); /* Daha zarif gölge */
            margin-top: 10px;
        }
        #calculate-btn:hover {
            background-color: var(--dark-bg);
            color: var(--success-neon);
            border: 1px solid var(--success-neon); /* İnce kenarlık */
        }

        #new-game-btn {
            background-color: transparent;
            color: var(--main-neon);
            border: 1px solid var(--main-neon); /* İnce kenarlık */
            margin-top: 15px; /* Boşluk ayarı */
        }
        #new-game-btn:hover {
            background-color: var(--main-neon);
            color: var(--dark-bg);
            box-shadow: 0 0 8px rgba(137, 207, 240, 0.7); /* Daha zarif gölge */
        }

        /* --- HESAP MAKİNESİ (Panel) --- */
        .calculator-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--dark-bg);
            border: 1px solid var(--secondary-neon); /* İnce kenarlık */
            box-shadow: 0 0 15px rgba(170, 255, 221, 0.7); /* Daha zarif gölge */
            border-radius: 6px;
            z-index: 1000;
            width: 320px; /* Genişlik azaltıldı */
            padding-bottom: 10px;
        }
        
        #calc-data-set {
            background-color: rgba(255, 255, 255, 0.03); /* Daha şeffaf */
            padding: 8px;
            margin: 10px 12px;
            border: 1px dashed rgba(255, 153, 153, 0.5); /* Daha soluk noktalı çizgi */
            font-size: 0.9em;
            color: var(--danger-neon);
            text-shadow: 0 0 2px rgba(255, 153, 153, 0.7);
            max-height: 80px; /* Yükseklik azaltıldı */
            overflow-y: auto; 
        }
        
        .calc-header {
            background-color: #1a1f33; /* Daha uyumlu arka plan */
            padding: 8px;
            font-weight: bold;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            color: var(--secondary-neon);
            font-size: 1em;
        }
        #calc-display {
            width: calc(100% - 24px); /* Kenar boşluğu düzenlendi */
            margin: 12px;
            padding: 12px 10px;
            font-size: 1.3em;
            font-family: 'Roboto Mono', monospace;
            text-align: right;
            background-color: #000;
            color: var(--font-color);
            border: 1px solid var(--secondary-neon);
            border-radius: 4px;
        }
        .calc-keys {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px; /* Boşluklar azaltıldı */
            padding: 0 12px 0;
        }
        .calc-keys button {
            padding: 18px; /* Tuş dolgusu azaltıldı */
            font-size: 1.1em;
            font-family: 'Roboto Mono', monospace;
            border: 1px solid var(--border-color); /* İnce kenarlık */
            border-radius: 3px;
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.2); /* Daha şeffaf */
            color: var(--font-color); /* Tuş yazıları */
            transition: all 0.2s;
        }
        .calc-keys button:hover {
            background-color: rgba(170, 255, 221, 0.2); /* Hafif parlamalı hover */
            color: var(--secondary-neon);
            box-shadow: 0 0 8px rgba(170, 255, 221, 0.7); /* Yumuşak gölge */
        }
        .calc-keys .key-op {
            color: var(--accent-neon);
            border-color: rgba(255, 232, 153, 0.7); /* Yumuşak sarı kenarlık */
        }
        .calc-keys .key-op:hover {
            background-color: rgba(255, 232, 153, 0.2);
            color: var(--accent-neon);
        }
        .key-confirm {
            grid-column: span 4;
            background-color: var(--main-neon);
            color: var(--dark-bg);
            border: none;
            box-shadow: 0 0 8px rgba(137, 207, 240, 0.7);
        }
        .key-confirm:hover {
            background-color: var(--accent-neon);
            color: var(--dark-bg);
            box-shadow: 0 0 10px rgba(255, 232, 153, 0.9);
        }

        /* --- GERİ BİLDİRİM VE YENİ GÖREV --- */
        #feedback-area {
            margin-top: 20px;
            font-size: 1em;
            font-weight: bold;
            padding: 12px;
            border-radius: 4px;
            text-shadow: 0 0 3px currentColor; /* Yumuşak gölge */
        }
        .feedback-correct {
            background-color: rgba(137, 207, 240, 0.1); /* Daha şeffaf */
            color: var(--success-neon);
            border: 1px solid var(--success-neon);
        }
        .feedback-wrong {
            background-color: rgba(255, 153, 153, 0.1); /* Daha şeffaf */
            color: var(--danger-neon);
            border: 1px solid var(--danger-neon);
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h2>Aritmetik Ortalama Macerası</h2>

        <div class="story-box">
            <p id="story-text">Yükleniyor...</p>
            <div id="data-set"></div> 
        </div>

        <div class="formula-section" id="formula-section-1">
            <div class="formula-title">Temel A.O. Hesaplama</div>
            <div class="formula-board">
                <span class="formula-label">A.O =</span>
                <div class="fraction">
                    <input type="text" id="input-vt" class="formula-input" placeholder="V.T'yi Hesapla" readonly>
                    <div class="fraction-line"></div>
                    <input type="number" id="input-vs" class="formula-input" placeholder="V.S'yi Gir">
                </div>
            </div>
        </div>

        <div class="formula-section" id="formula-section-2">
             <div class="formula-title">Ters Hesaplama (Kayıp Veri)</div>
            
            <div class="formula-row">
                <input type="text" id="input-vt-calc" class="formula-input" placeholder="V.T Girişi" readonly>
                <span>=</span>
                <input type="text" id="input-ao-vt" class="formula-input" placeholder="A.O Girişi" readonly>
                <span>x</span>
                <input type="number" id="input-vs-vt" class="formula-input" placeholder="V.S Girişi">
            </div>
            
            <div class="formula-row">
                <input type="number" id="input-vs-calc" class="formula-input" placeholder="V.S Girişi">
                <span>=</span>
                <input type="text" id="input-vt-vs" class="formula-input" placeholder="V.T Girişi" readonly>
                <span>/</span>
                <input type="number" id="input-ao-vs" class="formula-input" placeholder="A.O Girişi">
            </div>
        </div>


        <button id="calculate-btn">Hesapla</button>

        <div id="feedback-area"></div>

        <button id="new-game-btn">Yeni Görev</button>
    </div>

    <div class="calculator-popup" id="calculator">
        <div class="calc-header">Hesaplayıcı (V.T. ve Diğer İşlemler)</div>
        
        <div id="calc-data-set"></div>

        <input type="text" id="calc-display" readonly>
        <div class="calc-keys">
            <button class="key-op" onclick="appendToDisplay('+')">+</button>
            <button class="key-op" onclick="appendToDisplay('-')">-</button>
            <button class="key-op" onclick="appendToDisplay('*')">x</button>
            <button class="key-op" onclick="appendToDisplay('/')">÷</button>

            <button onclick="appendToDisplay('7')">7</button>
            <button onclick="appendToDisplay('8')">8</button>
            <button onclick="appendToDisplay('9')">9</button>
            <button onclick="appendToDisplay('(')">(</button>
            
            <button onclick="appendToDisplay('4')">4</button>
            <button onclick="appendToDisplay('5')">5</button>
            <button onclick="appendToDisplay('6')">6</button>
            <button onclick="appendToDisplay(')')">)</button>
            
            <button onclick="appendToDisplay('1')">1</button>
            <button onclick="appendToDisplay('2')">2</button>
            <button onclick="appendToDisplay('3')">3</button>
            <button onclick="appendToDisplay('.')">.</button>
            
            <button class="key-op" onclick="clearDisplay()">Sil</button>
            <button onclick="appendToDisplay('0')">0</button>
            <button class="key-op" onclick="calculateResult()">=</button>
            <button class="key-op" onclick="clearAll()">C</button>
            
            <button class="key-confirm" onclick="confirmVT()">Sonucu Girişe Yansıt</button>
        </div>
    </div>

    <script>
        // --- OYUN VERİLERİ ---
        const gameData = [
             // Tip 1: Klasik A.O. Hesaplama (3 Senaryo)
            {
                type: 1,
                story: "Sincap Çıtçıt, 5 gün boyunca kış için ceviz topladı. Günlük topladığı ceviz sayıları:",
                data: [12, 10, 15, 8, 20],
                answerType: 'AO'
            },
            {
                type: 1,
                story: "Basketbolcu Efe, son 4 maçta şu sayıları attı:",
                data: [22, 18, 25, 19],
                answerType: 'AO'
            },
            {
                type: 1,
                story: "Bir haftalık (7 gün) hava sıcaklıkları (°C) şöyle ölçüldü:",
                data: [24, 26, 23, 25, 22, 27, 26],
                answerType: 'AO'
            },
            // Tip 2: Kayıp Veri Bulma (V.T. = A.O x V.S. ile Kayıp Değer Bulma) - 2 Senaryo
            {
                type: 2,
                // Kayıp kişi yaş: (5 * 24) - (4 * 20) = 120 - 80 = 40
                story: "4 kişilik turist kafilesinin yaş ortalaması **20**'dir. Gruba sonradan bir kişi daha katıldı ve grubun yeni yaş ortalaması **24** oldu. Son katılan kişi kaç yaşındadır?",
                formulaNeeded: 'VT',
                data: {
                    vt1: 4 * 20, 
                    vs1: 4,      
                    ao2: 24,     
                    vs2: 5       
                },
                question: 'Son katılan kişinin yaşını',
                correctAO: 40 
            },
            {
                type: 2,
                // Yanlış okunan not: (5 * 80) - (4 * 70) = 400 - 280 = 120
                story: "5 kişilik arkadaş grubunun matematikten son yazılıdan aldıkları notların ortalaması **80**'dir. Bu gruptan birinin yazılı kağıdının yanlış okunduğu anlaşıldı ve **kalan 4** öğrencinin ortalamasının **70** olduğu görüldü. Buna göre, kağıdı yanlış okunan öğrencinin notu kaç olmalıdır?",
                formulaNeeded: 'VT',
                data: {
                    vt1: 5 * 80, 
                    vs1: 5,
                    ao2: 70, 
                    vs2: 4   
                },
                question: 'Kağıdı yanlış okunan öğrencinin notunu',
                correctAO: 120
            },
             // Tip 2: Kayıp Veri Bulma (V.S. = V.T. / A.O. ile Veri Sayısı Bulma) - 4 Senaryo
            {
                type: 2,
                // İşçi sayısı: 5000 / 100 = 50
                story: "Bir fabrikadaki işçilerin günlük ortalama üretimi **100** birimdir. Fabrikadaki toplam üretim **5000** birim olduğuna göre, fabrikada kaç işçi (V.S.) çalışmaktadır?",
                formulaNeeded: 'VS',
                data: {
                    vt: 5000,
                    ao: 100
                },
                question: 'Çalışan işçi sayısını (V.S.)',
                correctAO: 50 
            },
            {
                type: 2,
                // Okunan Gün Sayısı: 350 / 70 = 5
                story: "Bir öğrencinin birkaç günde okuduğu toplam sayfa sayısı **350**'dir. Bu öğrencinin günlük okuduğu ortalama sayfa sayısı **70** sayfa ise, öğrenci kaç gün (V.S.) kitap okumuştur?",
                formulaNeeded: 'VS',
                data: {
                    vt: 350,
                    ao: 70
                },
                question: 'Kitap okuduğu gün sayısını (V.S.)',
                correctAO: 5 
            },
            {
                type: 2,
                // Maç Sayısı: 100 / 25 = 4
                story: "Bir futbolcunun attığı toplam gol sayısı **100**'dür. Maç başına düşen ortalama gol sayısı **25** olduğuna göre, futbolcu kaç maç (V.S.) oynamıştır?",
                formulaNeeded: 'VS',
                data: {
                    vt: 100,
                    ao: 25
                },
                question: 'Oynadığı maç sayısını (V.S.)',
                correctAO: 4 
            },
            {
                type: 2,
                // Günlük Satış Adedi: 1200 / 60 = 20
                story: "Bir mağazanın bir ayda sattığı toplam tişört sayısı **1200** adettir. Mağazanın günlük ortalama tişört satışı **60** adet olduğuna göre, kaç gün (V.S.) satış yapmıştır? (1 ay 30 gün kabul edin.)",
                formulaNeeded: 'VS',
                data: {
                    vt: 1200,
                    ao: 60
                },
                question: 'Satış yaptığı gün sayısını (V.S.)',
                correctAO: 20 
            }
        ];

        let currentProblem = {};
        let activeInputId = null; // Hangi inputun hesap makinesini açtığını takip eder

        // --- HTML ELEMENTLERİNİ SEÇME ---
        const storyText = document.getElementById('story-text');
        const dataSetText = document.getElementById('data-set');
        
        // Tip 1 alanları
        const inputVT = document.getElementById('input-vt');
        const inputVS = document.getElementById('input-vs');
        
        // Tip 2 alanları (V.T. = A.O x V.S)
        const inputVTCalc = document.getElementById('input-vt-calc'); // SONUÇ GİRİŞİ (Kayıp Değer)
        const inputAOVt = document.getElementById('input-ao-vt');
        const inputVSVt = document.getElementById('input-vs-vt');
        
        // Tip 2 alanları (V.S. = V.T / A.O)
        const inputVSCalc = document.getElementById('input-vs-calc'); // SONUÇ GİRİŞİ (Veri Sayısı)
        const inputVTVs = document.getElementById('input-vt-vs');
        const inputAOVB = document.getElementById('input-ao-vs'); 

        const formulaSection1 = document.getElementById('formula-section-1');
        const formulaSection2 = document.getElementById('formula-section-2');

        const calculateBtn = document.getElementById('calculate-btn');
        const feedbackArea = document.getElementById('feedback-area');
        const newGameBtn = document.getElementById('new-game-btn');
        const calculator = document.getElementById('calculator');
        const calcDisplay = document.getElementById('calc-display');
        const calcDataSet = document.getElementById('calc-data-set');

        // --- HESAPLAMA POP-UP MANTIĞI ---
        function showCalculator(inputId, showData = false) {
            activeInputId = inputId;
            calcDisplay.value = '';
            
            if (showData && currentProblem.data && Array.isArray(currentProblem.data)) {
                calcDataSet.innerText = `Veri Seti: [ ${currentProblem.data.join(', ')} ]`;
                calcDataSet.style.display = 'block';
            } else {
                calcDataSet.style.display = 'none';
            }
            
            calculator.style.display = 'block';
        }
        
        // Hesap Makinesini açan inputlar:
        inputVT.addEventListener('click', () => showCalculator('input-vt', true));
        inputVTCalc.addEventListener('click', () => showCalculator('input-vt-calc', false));
        inputAOVt.addEventListener('click', () => showCalculator('input-ao-vt', false));
        inputVTVs.addEventListener('click', () => showCalculator('input-vt-vs', false));
        
        
        function appendToDisplay(value) {
            const lastChar = calcDisplay.value.slice(-1);
            if (['+', '-', '*', '/'].includes(value) && ['+', '-', '*', '/'].includes(lastChar)) {
                calcDisplay.value = calcDisplay.value.slice(0, -1) + value; 
            } else {
                calcDisplay.value += value;
            }
        }

        function clearDisplay() {
            calcDisplay.value = calcDisplay.value.slice(0, -1);
        }
        
        function clearAll() {
            calcDisplay.value = '';
        }
        
        function calculateResult() {
            try {
                // Güvenli hesaplama
                const result = new Function('return ' + calcDisplay.value.replace(/x/g, '*').replace(/÷/g, '/'))(); 
                calcDisplay.value = result;
            } catch (error) {
                calcDisplay.value = 'HATA';
            }
        }

        function confirmVT() {
            calculateResult(); 

            const targetInput = document.getElementById(activeInputId);
            
            if (targetInput && calcDisplay.value !== 'HATA') {
                targetInput.value = calcDisplay.value;
            }
            calculator.style.display = 'none';
            checkInputs(); // Giriş yapıldıktan sonra butonu kontrol et
        }

        // --- OYUN MANTIĞI ---
        function startNewGame() {
            const randomIndex = Math.floor(Math.random() * gameData.length);
            const problem = gameData[randomIndex];
            currentProblem = problem;

            storyText.innerText = problem.story;
            feedbackArea.innerHTML = '';
            feedbackArea.className = '';
            calculateBtn.style.display = 'none'; // Başlangıçta butonu gizle

            document.querySelectorAll('.formula-input').forEach(input => input.value = '');
            
            if (problem.type === 1) {
                // Tip 1: Klasik A.O.
                formulaSection1.style.display = 'block';
                formulaSection2.style.display = 'none';
                
                dataSetText.innerText = `[ ${problem.data.join(', ')} ]`;
                dataSetText.style.display = 'block'; 
                
            } else {
                // Tip 2: Kayıp Veri Bulma
                formulaSection1.style.display = 'none';
                formulaSection2.style.display = 'block';
                
                dataSetText.innerText = ''; 
                dataSetText.style.display = 'none';
                
                // Placeholder ayarları
                inputVTCalc.placeholder = problem.formulaNeeded === 'VT' ? 'SONUÇ' : 'V.T Girişi';
                inputVSCalc.placeholder = problem.formulaNeeded === 'VS' ? 'SONUÇ' : 'V.S Girişi';
                
                // Tip 2'de ilgili sabit değerleri doldur
                if (problem.formulaNeeded === 'VT') {
                    // Kayıp Değer (V.T.) için gerekli olan A.O ve V.S değerleri
                    inputAOVt.value = problem.data.ao2;
                    inputVSVt.value = problem.data.vs2;
                } else if (problem.formulaNeeded === 'VS') {
                    // Veri Sayısı (V.S.) için gerekli olan V.T ve A.O değerleri
                    inputVTVs.value = problem.data.vt;
                    inputAOVB.value = problem.data.ao;
                }
            }
        }

        // --- HESAPLA BUTONU KONTROLÜ (DÜZELTİLMİŞ) ---
        function checkInputs() {
            let buttonShouldBeVisible = false;
            
            if (currentProblem.type === 1) {
                // Tip 1: Hem VT hem de VS dolu olmalı
                if (inputVT.value.trim() && inputVS.value.trim() && parseFloat(inputVS.value.trim()) > 0) {
                    buttonShouldBeVisible = true;
                }
            } 
            
            else if (currentProblem.type === 2) {
                if (currentProblem.formulaNeeded === 'VT') {
                    // Tip 2 (Kayıp Değer): Sadece FINAL SONUÇ kutusu (inputVTCalc) dolu olmalı
                    if (inputVTCalc.value.trim()) { 
                        buttonShouldBeVisible = true;
                    }
                } else if (currentProblem.formulaNeeded === 'VS') {
                    // Tip 2 (Veri Sayısı): Sadece FINAL SONUÇ kutusu (inputVSCalc) dolu olmalı
                    if (inputVSCalc.value.trim()) { 
                        buttonShouldBeVisible = true;
                    }
                }
            }

            if (buttonShouldBeVisible) {
                calculateBtn.style.display = 'block';
            } else {
                calculateBtn.style.display = 'none';
            }
        }

        function checkAnswer() {
            let userAnswer = NaN;
            
            // Tip 1: Klasik A.O. Kontrolü
            if (currentProblem.type === 1) {
                const userVT = parseFloat(inputVT.value);
                const userVS = parseFloat(inputVS.value);
                
                const correctVT = currentProblem.data.reduce((sum, current) => sum + current, 0);
                const correctVS = currentProblem.data.length;
                const correctAO = correctVT / correctVS;
                
                if (Math.abs(userVT - correctVT) < 0.01 && Math.abs(userVS - correctVS) < 0.01) {
                    feedbackArea.className = 'feedback-correct';
                    feedbackArea.innerHTML = `🎉 TEBRİKLER! Ortalama başarıyla hesaplandı: **A.O = ${correctAO.toFixed(2)}**`;
                } else if (Math.abs(userVT - correctVT) >= 0.01) {
                    feedbackArea.className = 'feedback-wrong';
                    feedbackArea.innerHTML = `⚠️ HATA: **Verilerin Toplamı (V.T)** yanlış girildi. Tekrar kontrol et.`;
                } else if (Math.abs(userVS - correctVS) >= 0.01) {
                    feedbackArea.className = 'feedback-wrong';
                    feedbackArea.innerHTML = `⚠️ HATA: **Veri Sayısı (V.S)** yanlış girildi. Tekrar kontrol et.`;
                }
            } 
            
            // Tip 2: Kayıp Veri Kontrolü
            else if (currentProblem.type === 2) {
                if (currentProblem.formulaNeeded === 'VT') {
                    userAnswer = parseFloat(inputVTCalc.value); 
                } else if (currentProblem.formulaNeeded === 'VS') {
                    userAnswer = parseFloat(inputVSCalc.value); 
                }
                
                const correctFinalAnswer = currentProblem.correctAO; 
                
                if (Math.abs(userAnswer - correctFinalAnswer) < 0.01) {
                     feedbackArea.className = 'feedback-correct';
                     feedbackArea.innerHTML = `🎉 TEBRİKLER! **${currentProblem.question}** doğru bulundu: **${correctFinalAnswer}**`;
                } else {
                     feedbackArea.className = 'feedback-wrong';
                     feedbackArea.innerHTML = `⚠️ HATA: **${currentProblem.question}** yanlış hesaplandı. Cevabın **${correctFinalAnswer}** olması gerekiyordu. Formülleri doğru kullandığından emin ol.`;
                }
            }
        }

        // --- OLAY DİNLEYİCİLER (EVENT LISTENERS) ---
        
        // Tip 1 Kontrolü için dinleyici
        inputVS.addEventListener('input', checkInputs);
        
        // Tip 2 Kontrolü için final sonuç kutularına dinleyici eklendi
        // Kullanıcı bu kutulara manuel olarak da yazabilir.
        inputVSCalc.addEventListener('input', checkInputs);
        inputVTCalc.addEventListener('input', checkInputs);
        
        // Diğer inputlara da dinleyici eklendi, böylece herhangi bir etkileşimde kontrol tetiklenir.
        inputVSVt.addEventListener('input', checkInputs);
        inputAOVB.addEventListener('input', checkInputs);
        inputVTVs.addEventListener('input', checkInputs);
        inputAOVB.addEventListener('input', checkInputs);
        
        
        calculateBtn.addEventListener('click', checkAnswer);
        newGameBtn.addEventListener('click', startNewGame);

        // Sayfa ilk yüklendiğinde oyunu başlat
        startNewGame();
    </script>
</body>
</html>
